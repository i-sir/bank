<!--客户类型:1农户,2牧户,3个体工商户,4公职人员,5政府全资或控股企业正式职工,6社区居民,7民营小微企业,8合作经济组织,9政府全资或控股企业,10行政事业单位,11其他群体-->
<div class="form-group">
    <label class="col-sm-2 control-label">类型:</label>
    <div class="layui-input-block col-sm-6">
        <if condition="!empty($type)">
            <select class="form-control post-params" lay-search lay-filter="type" name="type">
                <foreach item="vo" key="key" name="type_list">
                    <option value="{$key}"
                    <if condition="$type eq $key ">selected</if>
                    >{$vo}</option>
                </foreach>
            </select>
            <else/>
            <select class="form-control post-params" lay-search lay-filter="type" name="type">
                <foreach item="vo" key="key" name="type_list">
                    <option value="{$key}">{$vo}</option>
                </foreach>
            </select>
        </if>
    </div>
</div>


<!--备注-->
<div class="form-group">
    <label class="col-sm-2 control-label">备注:</label>
    <div class="layui-input-block col-sm-6">
        <input type="text" name="name" class="form-control post-params item-left" value="{$name|default=''}">
    </div>
</div>

<div class="form-group">
    <div class="layui-form-item">
        <label class="col-sm-2 control-label">基础信息:</label>
        <div class="col-md-6 col-sm-10" id="data_value00001">
            <!-- 已有数据的字段 -->
            <if condition="!empty($value)">
                <foreach item="data_val" key="data_index" name="value">
                    <div class="item-container">
                        <!-- 字段名称输入框 -->
                        <div class="layui-inline">
                            <input class="form-control post-params" name="data_key[{$data_index}]"
                                   placeholder="名称" type="text" value="{$data_val.name}">
                        </div>
                        <!-- 类型选择器 -->
                        <div class="layui-inline switch-container">
                            <span class="switch-text">类型:</span>
                            <select name="data_type[{$data_index}]" class="form-control post-params type-select"
                                    data-index="{$data_index}" lay-filter="typeSelect">
                                <option value="text" <if condition="$data_val.type eq 'text'">selected</if>>问答</option>
                                <option value="radio" <if condition="$data_val.type eq 'radio'">selected</if>>单选</option>
                                <option value="checkbox" <if condition="$data_val.type eq 'checkbox'">selected</if>>多选</option>
                            </select>
                        </div>
                        <!-- 删除按钮 -->
                        <div class="layui-inline">
                            <button class="layui-btn layui-btn-danger layui-btn-sm removeclass" type="button">
                                <i class="layui-icon">&#xe67e;</i>
                            </button>
                        </div>

                        <!-- 选项列表（默认隐藏，多选/单选时显示） -->
                        <div class="options-list options-list-{$data_index}">
                            <if condition="!empty($data_val.options)">
                                <foreach item="option" key="opt_index" name="data_val.options">
                                    <div class="option-item">
                                        <input type="text" class="form-control" name="options[{$data_index}][]"
                                               value="{$option}" placeholder="选项内容">
                                        <button type="button" class="layui-btn layui-btn-danger layui-btn-sm remove-option">
                                            <i class="layui-icon">&#xe67e;</i>
                                        </button>
                                    </div>
                                </foreach>
                            </if>
                            <button type="button" class="layui-btn layui-btn-normal layui-btn-sm add-option"
                                    style="margin-top: 5px;" data-index="{$data_index}">
                                <i class="layui-icon">&#xe654;</i> 添加选项
                            </button>
                        </div>
                    </div>
                </foreach>
            </if>

            <!-- 新增空白字段 -->
            <div class="item-container">
                <div class="layui-inline">
                    <input class="form-control post-params" name="data_key[99999999999999]"
                           placeholder="名称" type="text">
                </div>
                <div class="layui-inline switch-container">
                    <span class="switch-text">类型:</span>
                    <select name="data_type[99999999999999]" class="form-control post-params type-select"
                            data-index="99999999999999" lay-filter="typeSelect">
                        <option value="text">问答</option>
                        <option value="radio">单选</option>
                        <option value="checkbox">多选</option>
                    </select>
                </div>
                <div class="layui-inline">
                    <button class="layui-btn layui-btn-warm layui-btn-sm" id="button_data_value00001" type="button">
                        <i class="layui-icon">&#xe654; </i>
                    </button>
                </div>

                <!-- 选项列表（默认隐藏） -->
                <div class="options-list options-list-99999999999999">
                    <div class="options-list-inner"></div>
                    <button type="button" class="layui-btn layui-btn-normal layui-btn-sm add-option"
                            style="margin-top: 5px;" data-index="99999999999999">
                        <i class="layui-icon">&#xe654;</i> 添加选项
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .layui-btn .layui-icon {
        vertical-align: middle !important;
    }

    /* 主容器样式 */
    #data_value00001 {
        padding: 20px;
        background-color: #f9fafb;
        border-radius: 8px;
    }

    /* 字段容器样式 */
    .item-container {
        margin-bottom: 16px;
        padding: 15px;
        background-color: #fff;
        border-radius: 6px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        transition: all 0.2s ease;
    }

    .item-container:hover {
        box-shadow: 0 3px 8px rgba(0, 0, 0, 0.08);
    }

    /* 优化输入框和选择器样式 */
    .form-control.post-params {
        padding: 8px 12px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
        transition: all 0.2s;
        min-width: 200px;
    }

    .form-control.post-params:focus {
        border-color: #4096ff;
        box-shadow: 0 0 0 2px rgba(64, 150, 255, 0.2);
        outline: none;
    }

    select.form-control.post-params {
        padding: 7px 12px;
        min-width: 120px;
    }

    /* 优化开关和文本对齐 */
    .switch-container {
        display: flex;
        align-items: center;
        gap: 8px;
        white-space: nowrap;
    }

    .switch-text {
        color: #666;
        font-size: 14px;
    }

    /* 选项列表样式 - 增加缩进明确层级 */
    .options-list {
        display: none;
        margin-top: 12px;
        padding-left: 140px; /* 增加缩进，明确是子元素 */
        width: 100%;
        animation: fadeIn 0.2s ease;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(5px); }
        to { opacity: 1; transform: translateY(0); }
    }

    /* 选项项样式 */
    .option-item {
        display: flex;
        align-items: center;
        margin-top: 8px;
        gap: 8px;
    }

    .option-item .form-control {
        flex: 1;
        min-width: 200px;
    }

    /* 按钮样式优化 */
    .layui-btn-sm {
        padding: 0 12px;
        height: 34px;
        line-height: 34px;
        border-radius: 4px;
        transition: all 0.2s;
    }

    .removeclass {
        background-color: #ff4d4f;
        border-color: #ff4d4f;
    }

    .removeclass:hover {
        background-color: #f5222d !important;
        transform: translateY(-1px);
        box-shadow: 0 2px 5px rgba(245, 34, 45, 0.2);
    }

    #button_data_value00001 {
        background-color: #faad14;
        border-color: #faad14;
    }

    #button_data_value00001:hover {
        background-color: #fa8c16 !important;
        transform: translateY(-1px);
        box-shadow: 0 2px 5px rgba(250, 173, 20, 0.3);
    }

    .add-option {
        background-color: #1890ff;
        border-color: #1890ff;
    }

    .add-option:hover {
        background-color: #096dd9 !important;
        transform: translateY(-1px);
    }

    .remove-option {
        background-color: #ff7a45;
        border-color: #ff7a45;
    }

    .remove-option:hover {
        background-color: #ff4d00 !important;
    }

    /* 响应式调整 */
    @media (max-width: 768px) {
        .item-container {
            flex-direction: column;
            align-items: flex-start;
        }

        .layui-inline {
            margin-bottom: 10px;
            width: 100%;
        }

        .form-control.post-params,
        select.form-control.post-params {
            width: 100%;
            min-width: auto;
        }

        .options-list {
            padding-left: 0;
            margin-top: 10px;
        }
    }
</style>

<script>
    layui.use(['element', 'jquery', 'layer', 'form', 'laydate'], function () {
        var form = layui.form
            , element = layui.element
            , laydate = layui.laydate
            , $ = layui.$;

        // 初始化函数：控制选项列表的显示状态
        function setOptionsShow(index, type) {
            // 获取当前索引对应的选项列表
            var $optionsList = $('.options-list-' + index);

            // 验证元素是否存在
            if (!$optionsList.length) {
                console.warn('未找到索引为 ' + index + ' 的选项列表');
                return;
            }

            // 根据类型设置显示状态
            if (type === 'radio' || type === 'checkbox') {
                $optionsList.show();

                // 空选项列表自动添加一个选项
                if ($optionsList.find('.option-item').length === 0) {
                    $optionsList.find('.add-option').trigger('click');
                }
            } else {
                $optionsList.hide();
            }
        }

        // 页面加载时初始化所有字段的显示状态
        $(document).ready(function() {
            $('.type-select').each(function() {
                var $this = $(this);
                var type = $this.val();
                var index = $this.attr('data-index');
                setOptionsShow(index, type);
            });
        });

        // 监听选择器变化
        form.on('select(typeSelect)', function(data) {
            var $select = $(data.elem);
            var index = $select.attr('data-index');
            var selectedType = data.value;
            setOptionsShow(index, selectedType);
        });

        // 删除整个字段
        $("body").on('click', ".removeclass", function () {
            if (confirm('确定要删除这个字段吗？')) {
                // 添加删除动画
                var $container = $(this).closest('.item-container');
                $container.css('opacity', '0');
                $container.css('transform', 'translateY(10px)');
                setTimeout(function() {
                    $container.remove();
                }, 200);
            }
        });

        // 添加选项
        $("body").on('click', '.add-option', function () {
            var $this = $(this);
            var index = $this.attr('data-index');
            var $optionsList = $this.closest('.options-list');
            var $optionsListInner = $optionsList.find('.options-list-inner');

            // 如果没有inner容器，直接添加到列表中
            if (!$optionsListInner.length) {
                $optionsListInner = $optionsList;
            }

            var optionHtml = '<div class="option-item" style="opacity:0; transform:translateY(5px);">' +
                '<input type="text" class="form-control" name="options[' + index + '][]" placeholder="选项内容">' +
                '<button type="button" class="layui-btn layui-btn-danger layui-btn-sm remove-option">' +
                '<i class="layui-icon">&#xe67e;</i>' +
                '</button>' +
                '</div>';

            var $option = $(optionHtml);
            $optionsListInner.append($option);

            // 触发动画
            setTimeout(function() {
                $option.css('opacity', '1');
                $option.css('transform', 'translateY(0)');
            }, 10);

            // 自动聚焦到新添加的输入框
            $option.find('input').focus();
        });

        // 删除单个选项
        $("body").on('click', '.remove-option', function () {
            var $optionItem = $(this).closest('.option-item');
            // 确保至少保留一个选项
            if ($optionItem.siblings('.option-item').length > 0 || confirm('确定要删除最后一个选项吗？')) {
                $optionItem.css('opacity', '0');
                $optionItem.css('transform', 'translateY(5px)');
                setTimeout(function() {
                    $optionItem.remove();
                }, 200);
            }
        });

        // 新增字段
        $("#button_data_value00001").click(function () {
            var newIndex = Date.now() + Math.floor(Math.random() * 1000);
            var newFieldHtml = '<div class="item-container" style="opacity:0; transform:translateY(10px);">' +
                '<div class="layui-inline">' +
                '<input type="text" name="data_key[' + newIndex + ']" class="form-control post-params" placeholder="名称">' +
                '</div>' +
                '<div class="layui-inline switch-container">' +
                '<span class="switch-text">类型:</span>' +
                '<select name="data_type[' + newIndex + ']" class="form-control post-params type-select" data-index="' + newIndex + '" lay-filter="typeSelect">' +
                '<option value="text">问答</option>' +
                '<option value="radio">单选</option>' +
                '<option value="checkbox">多选</option>' +
                '</select>' +
                '</div>' +
                '<div class="layui-inline">' +
                '<button type="button" class="layui-btn layui-btn-danger layui-btn-sm removeclass"> <i class="layui-icon">&#xe67e;</i> </button>' +
                '</div>' +
                '<div class="options-list options-list-' + newIndex + '">' +
                '<div class="options-list-inner"></div>' +
                '<button type="button" class="layui-btn layui-btn-normal layui-btn-sm add-option" style="margin-top: 5px;" data-index="' + newIndex + '">' +
                '<i class="layui-icon">&#xe654;</i> 添加选项' +
                '</button>' +
                '</div>' +
                '</div>';

            var $newField = $(newFieldHtml);
            $("#data_value00001").append($newField);
            form.render('select'); // 重新渲染select，确保layui样式生效

            // 触发动画
            setTimeout(function() {
                $newField.css('opacity', '1');
                $newField.css('transform', 'translateY(0)');
            }, 10);

            // 自动聚焦到新字段的输入框
            $newField.find('input').focus();
        });
    });
</script>









