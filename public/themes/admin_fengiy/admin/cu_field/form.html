<!--客户类型:1农户,2牧户,3个体工商户,4公职人员,5政府全资或控股企业正式职工,6社区居民,7民营小微企业,8合作经济组织,9政府全资或控股企业,10行政事业单位,11其他群体-->
<div class="form-group">
    <label class="col-sm-2 control-label">类型:</label>
    <div class="layui-input-block col-sm-6">
        <if condition="!empty($type)">
            <select class="form-control post-params" lay-search lay-filter="type" name="type">
                <foreach item="vo" key="key" name="type_list">
                    <option value="{$key}"
                    <if condition="$type eq $key ">selected</if>
                    >{$vo}</option>
                </foreach>
            </select>
            <else/>
            <select class="form-control post-params" lay-search lay-filter="type" name="type">
                <foreach item="vo" key="key" name="type_list">
                    <option value="{$key}">{$vo}</option>
                </foreach>
            </select>
        </if>
    </div>
</div>


<!--备注-->
<div class="form-group">
    <label class="col-sm-2 control-label">备注:</label>
    <div class="layui-input-block col-sm-6">
        <input type="text" name="name" class="form-control post-params item-left" value="{$name|default=''}">
    </div>
</div>


<div class="form-group">
    <div class="layui-form-item">
        <label class="col-sm-2 control-label">基础信息:</label>
        <div class="col-md-6 col-sm-10" id="data_value00001">
            <!-- 已有数据的字段 -->
            <if condition="!empty($value)">
                <foreach item="data_val" key="data_index" name="value">
                    <div class="item-container">
                        <!-- 字段名称标签和输入框 -->
                        <div class="form-field name-field">
                            <span class="field-label">名称:</span>
                            <input class="form-control post-params name-input" name="data_key[{$data_index}]"
                                   placeholder="请输入名称" type="text" value="{$data_val.name}">
                        </div>

                        <!-- 类型选择器 -->
                        <div class="form-field type-field">
                            <span class="field-label">类型:</span>
                            <select name="data_type[{$data_index}]" class="form-control post-params type-select"
                                    data-index="{$data_index}" lay-filter="typeSelect">
                                <option value="text"
                                <if condition="$data_val.type eq 'text'">selected</if>
                                >问答</option>
                                <option value="radio"
                                <if condition="$data_val.type eq 'radio'">selected</if>
                                >单选</option>
                                <option value="checkbox"
                                <if condition="$data_val.type eq 'checkbox'">selected</if>
                                >多选</option>
                            </select>
                        </div>

                        <!-- 操作按钮 -->
                        <div class="form-actions">
                            <button class="layui-btn layui-btn-danger layui-btn-sm removeclass" type="button">
                                <i class="layui-icon">&#xe67e;</i>
                            </button>
                        </div>

                        <!-- 选项列表（默认隐藏，多选/单选时显示） -->
                        <div class="options-list options-list-{$data_index}">
                            <if condition="!empty($data_val.options)">
                                <foreach item="option" key="opt_index" name="data_val.options">
                                    <div class="option-item">
                                        <input type="text" class="form-control" name="options[{$data_index}][]"
                                               value="{$option}" placeholder="选项内容">
                                        <button type="button"
                                                class="layui-btn layui-btn-danger layui-btn-sm remove-option">
                                            <i class="layui-icon">&#xe67e;</i>
                                        </button>
                                    </div>
                                </foreach>
                            </if>
                            <button type="button" class="layui-btn layui-btn-primary layui-btn-sm add-option"
                                    data-index="{$data_index}">
                                <i class="layui-icon">&#xe654;</i> 添加选项
                            </button>
                        </div>
                    </div>
                </foreach>
            </if>

            <!-- 新增空白字段按钮 -->
            <div class="add-item-container">
                <button class="layui-btn layui-btn-primary layui-btn-sm" id="button_data_value00001" type="button">
                    <i class="layui-icon">&#xe654; </i> 添加字段
                </button>
            </div>
        </div>
    </div>
</div>

<style>
    /* 图标垂直居中 */
    .layui-btn .layui-icon {
        vertical-align: middle !important;
    }

    /* 主容器样式 - 保持原有背景和内边距 */
    #data_value00001 {
        padding: 20px;
        background-color: #f5f7fa;
        border-radius: 6px;
    }

    /* 字段容器样式 - 核心调整：进一步增大底部间距（让每个字段包括新增的都更靠下） */
    .item-container {
        display: flex;
        align-items: flex-start;
        flex-direction: column;
        margin-bottom: 56px;
        padding: 16px;
        background-color: #fff;
        border-radius: 4px;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        transition: all 0.2s ease;
    }

    /* 字段容器hover效果 */
    .item-container:hover {
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    }

    /* 添加按钮容器 - 核心调整：增大顶部间距（让“添加字段”按钮更靠下） */
    .add-item-container {
        margin-top: 15px; /* 从10px增至15px，与上方最后一个字段拉开更多距离 */
        text-align: left;
    }

    /* 字段标签样式 */
    .field-label {
        display: inline-block;
        width: 50px;
        color: #666;
        font-size: 14px;
        margin-right: 8px;
    }

    /* 表单字段容器 */
    .form-field {
        display: flex;
        align-items: center;
        width: 100%;
        margin-right: 0;
        margin-bottom: 12px;
    }

    /* 名称字段 - 取消最小宽度限制 */
    .name-field {
        min-width: auto;
    }

    /* 类型字段 - 取消最小宽度限制 */
    .type-field {
        min-width: auto;
    }

    /* 输入框和选择器基础样式 */
    .form-control.post-params {
        padding: 7px 12px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
        transition: all 0.2s;
    }

    /* 名称输入框 - 适应垂直布局 */
    .name-input {
        width: 100%;
        min-width: auto;
    }

    /* 输入框聚焦效果 */
    .form-control.post-params:focus {
        border-color: #2d8cf0;
        box-shadow: 0 0 0 2px rgba(45, 140, 240, 0.2);
        outline: none;
    }

    /* 选择器样式 */
    select.form-control.post-params {
        min-width: 120px;
        height: 32px;
        line-height: 32px;
    }

    /* 操作按钮容器 */
    .form-actions {
        margin-left: 0;
        margin-top: 8px;
    }

    /* 按钮基础样式 */
    .layui-btn-sm {
        padding: 0 12px;
        height: 32px;
        line-height: 32px;
        border-radius: 4px;
        transition: all 0.2s;
    }

    /* 删除字段按钮 */
    .removeclass {
        background-color: #f53f3f;
        border-color: #f53f3f;
    }

    .removeclass:hover {
        background-color: #e02020 !important;
        transform: translateY(-1px);
        box-shadow: 0 2px 5px rgba(224, 32, 32, 0.2);
    }

    /* 添加字段/选项按钮 */
    #button_data_value00001, .add-option {
        background-color: #00b42a;
        border-color: #00b42a;
        color: #fff;
    }

    #button_data_value00001:hover, .add-option:hover {
        background-color: #00a82d !important;
        transform: translateY(-1px);
        box-shadow: 0 2px 5px rgba(0, 168, 45, 0.2);
    }

    /* 删除选项按钮 */
    .remove-option {
        background-color: #ff7d00;
        border-color: #ff7d00;
    }

    .remove-option:hover {
        background-color: #f57200 !important;
    }

    /* 选项列表 */
    .options-list {
        display: none;
        width: 100%;
        margin-top: 12px;
        padding-left: 0;
        animation: fadeIn 0.2s ease;
    }

    /* 选项列表展开动画 */
    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(5px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* 选项项样式 */
    .option-item {
        display: flex;
        align-items: center;
        margin-top: 8px;
        margin-bottom: 4px;
        gap: 8px;
    }

    .option-item .form-control {
        flex: 1;
        min-width: 280px;
        max-width: 500px;
    }

    /* 响应式调整 */
    @media (max-width: 768px) {
        .item-container {
            flex-direction: column;
            align-items: flex-start;
            gap: 10px;
            margin-bottom: 25px; /* 同步增大移动端字段间距 */
        }

        .form-field {
            width: 100%;
            margin-right: 0;
            min-width: auto;
        }

        .form-actions {
            margin-left: 0;
            margin-top: 10px;
        }

        .name-input {
            width: 100%;
            min-width: auto;
        }

        .options-list {
            padding-left: 0;
            margin-top: 10px;
        }

        .add-item-container {
            margin-top: 15px; /* 同步增大移动端按钮间距 */
        }
    }
</style>

<script>
    layui.use(['element', 'jquery', 'layer', 'form', 'laydate'], function () {
        var form = layui.form
            , element = layui.element
            , laydate = layui.laydate
            , $ = layui.$;

        // 初始化函数：控制选项列表的显示状态
        function setOptionsShow(index, type) {
            var $optionsList = $('.options-list-' + index);
            if (!$optionsList.length) {
                console.warn('未找到索引为 ' + index + ' 的选项列表');
                return;
            }

            if (type === 'radio' || type === 'checkbox') {
                $optionsList.show();
                if ($optionsList.find('.option-item').length === 0) {
                    $optionsList.find('.add-option').trigger('click');
                }
            } else {
                $optionsList.hide();
            }
        }

        // 页面加载时初始化所有字段的显示状态
        $(document).ready(function () {
            $('.type-select').each(function () {
                var $this = $(this);
                var type = $this.val();
                var index = $this.attr('data-index');
                setOptionsShow(index, type);
            });
        });

        // 监听选择器变化：切换类型时显示/隐藏选项列表
        form.on('select(typeSelect)', function (data) {
            var $select = $(data.elem);
            var index = $select.attr('data-index');
            var selectedType = data.value;
            setOptionsShow(index, selectedType);
        });

        // 删除整个字段：带确认提示和过渡动画
        $("body").on('click', ".removeclass", function () {
            if (confirm('确定要删除这个字段吗？')) {
                var $container = $(this).closest('.item-container');
                $container.css('opacity', '0');
                $container.css('transform', 'translateY(10px)');
                setTimeout(function () {
                    $container.remove();
                }, 200);
            }
        });

        // 添加选项：带过渡动画，新增后自动聚焦输入框
        $("body").on('click', '.add-option', function () {
            var $this = $(this);
            var index = $this.attr('data-index');
            var $optionsList = $this.closest('.options-list');
            var $optionsListInner = $optionsList.find('.options-list-inner');

            if (!$optionsListInner.length) {
                $optionsListInner = $optionsList;
            }

            var optionHtml = '<div class="option-item" style="opacity:0; transform:translateY(5px);">' +
                '<input type="text" class="form-control" name="options[' + index + '][]" placeholder="选项内容">' +
                '<button type="button" class="layui-btn layui-btn-danger layui-btn-sm remove-option">' +
                '<i class="layui-icon">&#xe67e;</i>' +
                '</button>' +
                '</div>';

            var $option = $(optionHtml);
            $optionsListInner.append($option);

            setTimeout(function () {
                $option.css('opacity', '1');
                $option.css('transform', 'translateY(0)');
            }, 10);

            $option.find('input').focus();
        });

        // 删除单个选项：最后一个选项删除时带确认提示
        $("body").on('click', '.remove-option', function () {
            var $optionItem = $(this).closest('.option-item');
            if ($optionItem.siblings('.option-item').length > 0 || confirm('确定要删除最后一个选项吗？')) {
                $optionItem.css('opacity', '0');
                $optionItem.css('transform', 'translateY(5px)');
                setTimeout(function () {
                    $optionItem.remove();
                }, 200);
            }
        });

        // 新增字段：向下添加到列表末尾，带过渡动画和自动聚焦
        $("#button_data_value00001").click(function () {
            var newIndex = Date.now() + Math.floor(Math.random() * 1000);
            var newFieldHtml = '<div class="item-container" style="opacity:0; transform:translateY(10px);">' +
                '<div class="form-field name-field">' +
                '<span class="field-label">名称:</span>' +
                '<input type="text" name="data_key[' + newIndex + ']" class="form-control post-params name-input" placeholder="请输入名称">' +
                '</div>' +
                '<div class="form-field type-field">' +
                '<span class="field-label">类型:</span>' +
                '<select name="data_type[' + newIndex + ']" class="form-control post-params type-select" data-index="' + newIndex + '" lay-filter="typeSelect">' +
                '<option value="text">问答</option>' +
                '<option value="radio">单选</option>' +
                '<option value="checkbox">多选</option>' +
                '</select>' +
                '</div>' +
                '<div class="form-actions">' +
                '<button type="button" class="layui-btn layui-btn-danger layui-btn-sm removeclass"> <i class="layui-icon">&#xe67e;</i> </button>' +
                '</div>' +
                '<div class="options-list options-list-' + newIndex + '">' +
                '<div class="options-list-inner"></div>' +
                '<button type="button" class="layui-btn layui-btn-primary layui-btn-sm add-option" data-index="' + newIndex + '">' +
                '<i class="layui-icon">&#xe654;</i> 添加选项' +
                '</button>' +
                '</div>' +
                '</div>';

            var $newField = $(newFieldHtml);
            $(this).closest('.add-item-container').before($newField);

            setTimeout(function () {
                $newField.css('opacity', '1');
                $newField.css('transform', 'translateY(0)');
            }, 10);

            $newField.find('input').focus();
            form.render(); // 重新渲染layui表单，确保选择器生效
        });

        // 初始化layui表单
        form.render();
    });
</script>











